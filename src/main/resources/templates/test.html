<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"  layout:decorate="~{layout/default}" >
<section layout:fragment="content">
    <p th:text="test"></p>
    <main id="content" role="main">
        <!-- Hero Section -->
        <div class="gradient-overlay-half-dark-v3 bg-img-hero"  th:style="'background-image: url('+@{/img/test/000.jpg}+');'">
            <!-- Main Content -->
            <div class="d-lg-flex align-items-lg-center height-45vh--lg">
                <!-- 검색 Form -->
                <div class="container space-1 space-0--lg mt-lg-8">
                    <form class="js-validate w-lg-75 px-3 px-sm-9 mx-lg-auto justify-content-lg-between align-items-lg-center row">
                        <!--TODO 폼 너비 어떻게 조절? -->
                        <div class="col-lg-12">
                            <div class="bg-white shadow-sm rounded p-3">
                                <form class="js-validate">
                                    <!-- Input Form -->
                                    <!--지역-->
                                    <div class="row align-items-center">
                                        <div class="d-none d-md-block col-sm-2">
                                            <label class="h6 small d-block mb-3 mb-lg-0">지역</label>
                                        </div>

                                        <div class="col-12 col-sm-10 input-group form">
                                            <div id="addrWrap" class="position-absolute" style="display:none; border:1px solid #d4d7dd; height:400px;">
                                                <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
                                            </div>
                                            <input id="addr" type="text" class="form-control form__input form-control-sm"
                                                   placeholder="건물명,도로명,지번으로 검색하세요"
                                                   aria-label="Default example with button"
                                                   aria-describedby="inputGroup-sizing-default"
                                                    >
                                        </div>

                                        <!--<div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
                                        </div>-->
                                    </div>
                                </form>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- End 검색 Form -->
            </div>
        </div>
        <!-- End Hero Section -->

        <!-- 대리점 리스트 -->
        <div class="card-deck d-block d-lg-flex">
            <article class="card border-0 mb-2">
                <a href="agent" class="text-dark">
                    <div class="card-body row align-items-stretch no-gutters p-0">
                        <!-- News Blog Card -->
                        <div class="col-8 border border-right-0 ">
                            <h2 class="h6">대리점1</h2>
                            <address class="mb-0">
                                <ul class="list-unstyled font-size-14 text-secondary mb-0">
                                    <li class="py-1">서울 동대문구 이문동 204-397</li>
                                    <li class="py-2">취급품목:왕란 대란 소란</li>
                                    <li class="py-1">(02) 347 8854</li>
                                </ul>
                            </address>
                        </div>
                        <div class="col-4 border border-left-0 rounded-right">
                            <div id="map" class="js-g-map h-100"></div>
                        </div>
                    </div>
                </a>
                <!-- End News Blog Card -->
            </article>
            <article class="card border-0 mb-2">
                <a href="agent" class="text-dark">
                    <div class="card-body row align-items-stretch no-gutters p-0">
                        <!-- News Blog Card -->
                        <div class="col-8 border border-right-0 ">
                            <h2 class="h6">대리점1</h2>
                            <address class="mb-0">
                                <ul class="list-unstyled font-size-14 text-secondary mb-0">
                                    <li class="py-1">서울 동대문구 이문동 204-397</li>
                                    <li class="py-2">취급품목:왕란 대란 소란</li>
                                    <li class="py-1">(02) 347 8854</li>
                                </ul>
                            </address>
                        </div>
                        <div class="col-4 border border-left-0 rounded-right">
                            가게 간판? 가게전경?
                        </div>
                    </div>
                </a>
                <!-- End News Blog Card -->
            </article>
        </div>
    </main>

    <script th:inline="javascript" type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=af40a347c5a17c5118392cee56f35da6&libraries=services"></script>
    <script th:inline="javascript" type="text/javascript" src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/

        //var start2 = new google.maps.LatLng(37.5863393, 127.05535029999999);
        //var end2 = new google.maps.LatLng(37.8300323, 127.08584040000005);

        var start = new daum.maps.LatLng(37.5863393, 127.05535029999999);
        var end = new daum.maps.LatLng(37.8300323, 127.08584040000005);
        var lineLine = new daum.maps.Polyline();

        function distanceTo(p1,p2){

            lineLine.setPath([ p1, p2 ]); // //라인을 그리려면 두 점이 있어야하니깐 두 점을 지정했습니다 선을 그릴 라인을 세팅합니다
            var distance = Math.round(lineLine.getLength())/1000;
            return distance;
        }

        function tranceCoordsToAddr(latLng){
            // 주소로 좌표를 검색합니다
            var geocoder = new daum.maps.services.Geocoder();

            var callback = function(result, status) {
                if (status === daum.maps.services.Status.OK) {
                    //console.log('그런 너를 마주칠까 ' + result[0].address.address_name + '을 못가');
                    var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
                    detailAddr += result[0].address.address_name + '<br/>';
                    var content = detailAddr;
                    alert(content);
                }
            };
            geocoder.coord2Address(latLng.getLng(), latLng.getLat(), callback);

        }

        function serchAddress(addr) {

            if(addr == null){
                addr = document.getElementById("addr").value;
            }
            // 주소로 좌표를 검색합니다
            var geocoder = new daum.maps.services.Geocoder();
            geocoder.addressSearch(addr, function(result, status) {
                // 정상적으로 검색이 완료됐으면
                if (status === daum.maps.services.Status.OK) {

                    var coords = new daum.maps.LatLng(result[0].y, result[0].x);
                    alert(coords + "거리 : " +distanceTo(start,coords));
                    tranceCoordsToAddr(coords)
                }
            });
        }

        //load함수를 이용하여 core스크립트의 로딩이 완료된 후, 우편번호 서비스를 실행합니다.
        /*daum.postcode.load(function(){
            new daum.Postcode({
                oncomplete: function(data) {
                    // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분입니다.
                    // 예제를 참고하여 다양한 활용법을 확인해 보세요.
                }
            }).open();
        });*/

        $(document).ready(function() {
            //On pressing a key on "Search box" in "search.php" file. This function will be called.
            $("#addr").keyup(function() {
                //Assigning search box value to javascript variable named as "name".
                var name = $('#search').val();
            });
        });

        // 우편번호 찾기 찾기 화면을 넣을 element
        //var element_wrap = document.getElementById('wrap');
        var element_wrap = document.getElementById('addrWrap');

        function foldDaumPostcode() {
            // iframe을 넣은 element를 안보이게 한다.
            element_wrap.style.display = 'none';
            $("#addr").css("zIndex","");
        }

        function sample3_execDaumPostcode() {
            // 현재 scroll 위치를 저장해놓는다.
            var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
            var width = document.getElementById('addr').clientWidth;
            new daum.Postcode({
                oncomplete: function(data) {
                    // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                    // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                    // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                    var addr = ''; // 주소 변수
                    var extraAddr = ''; // 참고항목 변수

                    //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }

                    // 우편번호와 주소 정보를 해당 필드에 넣는다.
                    document.getElementById("addr").value = addr;

                    // iframe을 넣은 element를 안보이게 한다.
                    // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                    element_wrap.style.display = 'none';

                    // 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
                    document.body.scrollTop = currentScroll;
                    $("#addr").css("zIndex","");
                },
                hideMapBtn : true,
                hideEngBtn : true,
                zonecodeOnly : true,
                width : width,
                height : '100%'
            }).embed(element_wrap);

            // iframe을 넣은 element를 보이게 한다.
            element_wrap.style.display = 'block';
        }

        $(document).on('ready', function () {

            $("#addr").focus(function (obj) {
                $("#addr").css("zIndex","-1");
                sample3_execDaumPostcode();
                //$( "#target" ).focus();
                obj.target.blur();
            });

        });
        /*]]>*/
    </script>
</section>
</html>